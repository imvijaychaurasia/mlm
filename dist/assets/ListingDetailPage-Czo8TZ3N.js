import{l as S,j as e,V as le,r as ce,a6 as de,I as xe,R as f,X as he,J as a,T as s,K as d,L as me,O as B,_ as ue,P as w,a7 as pe,a8 as z,a9 as Q,aa as ge,Q as je,Y as ye,a5 as be}from"./index-C7BA2nKa.js";import{u as fe}from"./useQuery-XHw3bLzL.js";import{u as ve,P as Ce,E as we}from"./useContactPass-CH5NKsaN.js";import{g as Pe,c as Se,f as g}from"./pricing-CnH_CcUh.js";import{C as P}from"./Container-FmJye9ja.js";import{G as l,C as Ie}from"./Grid-C9ICj_rl.js";import{S as v}from"./Skeleton-WxiSc0oa.js";import{C as De}from"./CardMedia-6USqV9in.js";import{V as Ae}from"./Visibility-Br5zdAXP.js";import{F as We}from"./Favorite-sfP6a-21.js";import{C as Le}from"./CalendarToday-DoSID3I2.js";import{T as Re,a as L}from"./Tabs-Cil8wrWp.js";import{L as ke}from"./LocationOn-Dff0m1VB.js";import{T as Ee}from"./TextField-COzvgIyy.js";import{P as G}from"./Payment-ClRDvwlT.js";import{D as F,a as N,b as U,c as _,S as Te}from"./Snackbar-B3J4hnzK.js";const Ve=S([e.jsx("path",{d:"m12 2-5.5 9h11z"},"0"),e.jsx("circle",{cx:"17.5",cy:"17.5",r:"4.5"},"1"),e.jsx("path",{d:"M3 13.5h8v8H3z"},"2")]),Be=S(e.jsx("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3m-4.4 15.55-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05"})),ze=S(e.jsx("path",{d:"M21 6h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1m-4 6V3c0-.55-.45-1-1-1H3c-.55 0-1 .45-1 1v14l4-4h10c.55 0 1-.45 1-1"})),Qe=S(e.jsx("path",{d:"M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92"})),Ge=()=>{const{user:r,setUser:m}=le(),[i,o]=ce.useState(!1),u=Pe();return{loading:i,payListingFee:async x=>{if(!r)return!1;o(!0);try{return await new Promise(h=>setTimeout(h,1500)),console.log(`Listing ${x} payment successful`),!0}catch(h){return console.error("Listing payment failed:",h),!1}finally{o(!1)}},purchaseViewContactsAddon:async x=>{var h;if(!r)return!1;o(!0);try{await new Promise(c=>setTimeout(c,1500));const p={...r,entitlements:{...r.entitlements,addons:{...(h=r.entitlements)==null?void 0:h.addons,[x]:{canViewInterestedContacts:!0}}}};return m(p),!0}catch(p){return console.error("View contacts addon purchase failed:",p),!1}finally{o(!1)}},canViewContacts:x=>Se(r==null?void 0:r.entitlements,x),listingPrice:u.listingPrice,listingDuration:u.listingDuration,addonPrice:u.viewContactsAddonPrice}},M=/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/gi,$=/(\+91[-\s]?)?[6-9]\d{9}/g,H=/(?:https?:\/\/|www\.|wa\.me\/|t\.me\/|bit\.ly\/)\S+/gi,O=/(\d[\s-]){9,}\d|\d{10,}/g,X=(r,m=!1)=>{if(m)return{sanitized:r,hasRedactions:!1};let i=r,o=!1;return M.test(i)&&(i=i.replace(M,"[contact hidden]"),o=!0),$.test(i)&&(i=i.replace($,"[contact hidden]"),o=!0),H.test(i)&&(i=i.replace(H,"[link hidden]"),o=!0),O.test(i)&&(i=i.replace(O,"[contact hidden]"),o=!0),{sanitized:i,hasRedactions:o}};function R(r){const{children:m,value:i,index:o,...u}=r;return e.jsx("div",{role:"tabpanel",hidden:i!==o,id:`listing-tabpanel-${o}`,"aria-labelledby":`listing-tab-${o}`,...u,children:i===o&&e.jsx(a,{sx:{py:3},children:m})})}const ts=()=>{const{id:r}=de(),m=xe(),[i,o]=f.useState(0),[u,j]=f.useState(!1),[k,y]=f.useState(!1),[x,h]=f.useState(""),[p,c]=f.useState({open:!1,message:"",severity:"info"}),{data:t,isLoading:Y,error:K}=fe({queryKey:["listing",r],queryFn:()=>be().getListing(r),enabled:!!r}),{hasActivePass:C,purchaseContactPass:Z,loading:E,price:I,getDaysRemaining:q}=ve(),{purchaseViewContactsAddon:J,canViewContacts:D,loading:T,addonPrice:A}=Ge(),ee=[{id:"1",user:"Raj Kumar",question:"Is the phone still under warranty?",answer:"Yes, it has 6 months warranty remaining.",timestamp:new Date(Date.now()-864e5)},{id:"2",user:"Priya Singh",question:"Can you share more photos of the back?",answer:null,timestamp:new Date(Date.now()-36e5)}],V=[{id:"1",name:"Amit Patel",phone:"+919876543210",email:"amit@example.com",message:"Very interested in this phone. Can we meet tomorrow?",timestamp:new Date(Date.now()-72e5)},{id:"2",name:"Sneha Gupta",phone:"+919876543211",email:"sneha@example.com",message:"Is the price negotiable?",timestamp:new Date(Date.now()-144e5)}],b=n=>new Intl.DateTimeFormat("en-IN",{year:"numeric",month:"long",day:"numeric"}).format(n),se=()=>{navigator.share?navigator.share({title:t==null?void 0:t.title,text:t==null?void 0:t.description,url:window.location.href}):navigator.clipboard.writeText(window.location.href)},te=n=>{switch(n){case"active":return"success";case"sold":return"error";case"expired":return"warning";case"pending_payment":return"info";default:return"default"}},ne=n=>{switch(n){case"active":return"Available";case"sold":return"Sold";case"expired":return"Expired";case"pending_payment":return"Pending Payment";case"draft":return"Draft";case"rejected":return"Rejected";default:return n}},ae=()=>{C?c({open:!0,message:"Contact details revealed! You can now reach the seller.",severity:"success"}):j(!0)},ie=async()=>{await Z()?(j(!1),c({open:!0,message:`Contact Pass activated! Valid for ${q()} days.`,severity:"success"})):c({open:!0,message:"Payment failed. Please try again.",severity:"error"})},re=async()=>{if(!r)return;await J(r)?(y(!1),c({open:!0,message:"Contact details unlocked for interested users!",severity:"success"})):c({open:!0,message:"Payment failed. Please try again.",severity:"error"})},oe=()=>{const{sanitized:n,hasRedactions:W}=X(x);W&&c({open:!0,message:"Contact details are hidden. Get a Contact Pass to reach sellers.",severity:"info"}),console.log("Submitting question:",n),h(""),c({open:!0,message:"Question submitted successfully!",severity:"success"})};return K?e.jsx(P,{maxWidth:"lg",sx:{mt:4},children:e.jsx(he,{severity:"error",children:"Error loading listing. Please try again."})}):Y?e.jsx(P,{maxWidth:"lg",sx:{mt:4},children:e.jsxs(l,{container:!0,spacing:4,children:[e.jsxs(l,{item:!0,xs:12,md:8,children:[e.jsx(v,{variant:"rectangular",height:400,sx:{borderRadius:2,mb:2}}),e.jsx(v,{variant:"text",sx:{fontSize:"2rem",mb:1}}),e.jsx(v,{variant:"text",sx:{fontSize:"1.5rem",mb:2}}),e.jsx(v,{variant:"text",height:100})]}),e.jsx(l,{item:!0,xs:12,md:4,children:e.jsx(v,{variant:"rectangular",height:200,sx:{borderRadius:2}})})]})}):t?e.jsxs(P,{maxWidth:"lg",sx:{mt:2,mb:4},children:[e.jsxs(l,{container:!0,spacing:{xs:2,md:4},children:[e.jsxs(l,{item:!0,xs:12,lg:8,children:[e.jsx(Ie,{sx:{mb:3,borderRadius:3},children:e.jsx(De,{component:"img",sx:{height:{xs:250,sm:300,md:400},objectFit:"cover"},image:t.images[0]||"https://images.pexels.com/photos/593174/pexels-photo-593174.jpeg?auto=compress&cs=tinysrgb&w=800",alt:t.title})}),e.jsxs(a,{sx:{mb:3},children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"start",mb:2},children:[e.jsx(s,{variant:"h4",component:"h1",sx:{fontWeight:"bold",flexGrow:1,mr:2},children:t.title}),e.jsxs(a,{sx:{display:"flex",gap:1},children:[e.jsx(B,{label:ne(t.status),color:te(t.status),variant:"filled"}),e.jsx(B,{label:t.category,color:"primary",variant:"outlined"})]})]}),e.jsx(s,{variant:"h3",color:"primary",sx:{fontWeight:"bold",mb:2},children:g(t.price)}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:3,color:"text.secondary"},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Ae,{fontSize:"small",sx:{mr:.5}}),e.jsxs(s,{variant:"body2",children:[t.views," views"]})]}),e.jsxs(a,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(We,{fontSize:"small",sx:{mr:.5}}),e.jsxs(s,{variant:"body2",children:[t.favorites," favorites"]})]}),e.jsxs(a,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Le,{fontSize:"small",sx:{mr:.5}}),e.jsxs(s,{variant:"body2",children:["Posted ",b(t.createdAt)]})]})]})]}),e.jsx(ue,{sx:{my:3}}),e.jsxs(w,{elevation:2,sx:{borderRadius:2},children:[e.jsx(a,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Re,{value:i,onChange:(n,W)=>o(W),variant:"scrollable",scrollButtons:"auto",children:[e.jsx(L,{icon:e.jsx(Ve,{}),label:"Overview",iconPosition:"start"}),e.jsx(L,{icon:e.jsx(ze,{}),label:"Questions & Replies",iconPosition:"start"}),e.jsx(L,{icon:e.jsx(pe,{}),label:"Interested",iconPosition:"start"})]})}),e.jsxs(R,{value:i,index:0,children:[e.jsxs(a,{sx:{mb:4},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Description"}),e.jsx(s,{variant:"body1",sx:{lineHeight:1.7,whiteSpace:"pre-wrap"},children:t.description})]}),e.jsxs(a,{sx:{mb:4},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Details"}),e.jsxs(l,{container:!0,spacing:2,children:[e.jsxs(l,{item:!0,xs:6,children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Category"}),e.jsx(s,{variant:"body1",sx:{fontWeight:"medium"},children:t.category})]}),e.jsxs(l,{item:!0,xs:6,children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Subcategory"}),e.jsx(s,{variant:"body1",sx:{fontWeight:"medium"},children:t.subcategory})]}),e.jsxs(l,{item:!0,xs:6,children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Posted Date"}),e.jsx(s,{variant:"body1",sx:{fontWeight:"medium"},children:b(t.createdAt)})]}),e.jsxs(l,{item:!0,xs:6,children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Last Updated"}),e.jsx(s,{variant:"body1",sx:{fontWeight:"medium"},children:b(t.updatedAt)})]})]})]}),e.jsxs(a,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Location"}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(ke,{color:"primary",sx:{mr:1}}),e.jsxs(s,{variant:"body1",children:[t.location.address,", ",t.location.city,", ",t.location.state," - ",t.location.pincode]})]})]})]}),e.jsxs(R,{value:i,index:1,children:[e.jsx(s,{variant:"h6",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Questions & Replies"}),e.jsxs(a,{sx:{mb:4,p:3,bgcolor:"grey.50",borderRadius:2},children:[e.jsx(Ee,{fullWidth:!0,multiline:!0,rows:3,placeholder:"Ask a question about this listing...",value:x,onChange:n=>h(n.target.value),sx:{mb:2}}),e.jsx(d,{variant:"contained",onClick:oe,disabled:!x.trim(),children:"Ask Question"})]}),e.jsx(z,{children:ee.map(n=>e.jsxs(Q,{sx:{flexDirection:"column",alignItems:"flex-start",mb:2,p:2,bgcolor:"background.paper",borderRadius:2},children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",width:"100%",mb:1},children:[e.jsx(s,{variant:"subtitle2",sx:{fontWeight:"bold"},children:n.user}),e.jsx(s,{variant:"caption",color:"text.secondary",children:b(n.timestamp)})]}),e.jsxs(s,{variant:"body2",sx:{mb:1},children:["Q: ",n.question]}),n.answer&&e.jsxs(s,{variant:"body2",color:"primary",sx:{fontStyle:"italic"},children:["A: ",n.answer]})]},n.id))})]}),e.jsxs(R,{value:i,index:2,children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(s,{variant:"h6",sx:{fontWeight:"bold"},children:["Interested Users (",V.length,")"]}),!D(r)&&e.jsxs(d,{variant:"contained",color:"secondary",startIcon:e.jsx(G,{}),onClick:()=>y(!0),children:["Unlock Contacts - ",g(A)]})]}),e.jsx(z,{children:V.map(n=>e.jsx(Q,{sx:{mb:2,p:2,bgcolor:"background.paper",borderRadius:2},children:e.jsx(ge,{primary:e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(s,{variant:"subtitle1",sx:{fontWeight:"bold"},children:n.name}),e.jsx(s,{variant:"caption",color:"text.secondary",children:b(n.timestamp)})]}),secondary:e.jsxs(a,{children:[D(r)?e.jsxs(e.Fragment,{children:[e.jsxs(s,{variant:"body2",color:"text.secondary",children:["Phone: ",n.phone]}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:["Email: ",n.email]})]}):e.jsxs(e.Fragment,{children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Phone: (hidden)"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Email: (hidden)"})]}),e.jsx(s,{variant:"body2",sx:{mt:1},children:X(n.message,D(r)).sanitized})]})})},n.id))})]})]})]}),e.jsxs(l,{item:!0,xs:12,lg:4,children:[e.jsxs(w,{elevation:3,sx:{p:3,borderRadius:3,mb:3},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Seller Information"}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",mb:3},children:[e.jsx(je,{sx:{mr:2,width:56,height:56},children:t.sellerName.charAt(0)}),e.jsxs(a,{children:[e.jsx(s,{variant:"h6",sx:{fontWeight:"medium"},children:t.sellerName}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Verified Seller"})]})]}),e.jsxs(a,{sx:{display:"flex",flex:"column",gap:2,mb:3},children:[e.jsx(d,{variant:"contained",fullWidth:!0,size:"large",startIcon:C?e.jsx(Ce,{}):e.jsx(G,{}),onClick:ae,sx:{py:1.5},children:C?"Contact Seller":`Contact Pass - ${g(I)}`}),e.jsx(d,{variant:"outlined",fullWidth:!0,size:"large",startIcon:e.jsx(we,{}),sx:{py:1.5},children:"Send Message"})]}),C?e.jsxs(s,{variant:"body2",color:"text.secondary",textAlign:"center",children:["Phone: ",t.sellerPhone]}):e.jsx(s,{variant:"body2",color:"text.secondary",textAlign:"center",children:"Phone: (hidden - get Contact Pass)"})]}),e.jsxs(w,{elevation:3,sx:{p:3,borderRadius:3,mb:3},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Actions"}),e.jsxs(a,{sx:{display:"flex",gap:1},children:[e.jsx(d,{variant:"outlined",fullWidth:!0,startIcon:e.jsx(Be,{}),sx:{flexGrow:1},children:"Save"}),e.jsx(ye,{onClick:se,sx:{border:"1px solid",borderColor:"divider"},children:e.jsx(Qe,{})})]})]}),e.jsxs(w,{elevation:3,sx:{p:3,borderRadius:3,bgcolor:"info.light"},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Safety Tips"}),e.jsxs(a,{component:"ul",sx:{pl:2,m:0},children:[e.jsx(s,{component:"li",variant:"body2",sx:{mb:1},children:"Meet in a public place for transactions"}),e.jsx(s,{component:"li",variant:"body2",sx:{mb:1},children:"Inspect the item before making payment"}),e.jsx(s,{component:"li",variant:"body2",sx:{mb:1},children:"Don't share personal financial information"}),e.jsx(s,{component:"li",variant:"body2",children:"Trust your instincts"})]})]})]})]}),e.jsxs(F,{open:u,onClose:()=>j(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsxs(N,{children:["Contact Pass - ",g(I)," for 15 days"]}),e.jsxs(U,{children:[e.jsx(s,{variant:"body1",sx:{mb:2},children:"Get unlimited access to contact sellers for 15 days."}),e.jsxs(a,{component:"ul",sx:{pl:2,m:0},children:[e.jsx(s,{component:"li",variant:"body2",sx:{mb:1},children:"Contact unlimited sellers"}),e.jsx(s,{component:"li",variant:"body2",sx:{mb:1},children:"View phone numbers and email addresses"}),e.jsx(s,{component:"li",variant:"body2",sx:{mb:1},children:"Direct messaging capability"}),e.jsx(s,{component:"li",variant:"body2",children:"Valid for 15 days from purchase"})]})]}),e.jsxs(_,{children:[e.jsx(d,{onClick:()=>j(!1),children:"Cancel"}),e.jsx(d,{variant:"contained",onClick:ie,disabled:E,children:E?"Processing...":`Pay ${g(I)}`})]})]}),e.jsxs(F,{open:k,onClose:()=>y(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsxs(N,{children:["Unlock Contact Details - ",g(A)]}),e.jsxs(U,{children:[e.jsx(s,{variant:"body1",sx:{mb:2},children:"See contact details of users interested in this listing."}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"One-time payment for this listing only. You'll be able to see phone numbers and email addresses of interested buyers."})]}),e.jsxs(_,{children:[e.jsx(d,{onClick:()=>y(!1),children:"Cancel"}),e.jsx(d,{variant:"contained",onClick:re,disabled:T,children:T?"Processing...":`Pay ${g(A)}`})]})]}),e.jsx(Te,{open:p.open,autoHideDuration:4e3,onClose:()=>c({...p,open:!1}),message:p.message})]}):e.jsx(P,{maxWidth:"lg",sx:{mt:4},children:e.jsxs(a,{textAlign:"center",py:8,children:[e.jsx(s,{variant:"h5",gutterBottom:!0,children:"Listing not found"}),e.jsx(s,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"The listing you're looking for doesn't exist or has been removed."}),e.jsx(d,{variant:"contained",onClick:()=>m(me.LISTINGS),children:"Browse All Listings"})]})})};export{ts as default};
