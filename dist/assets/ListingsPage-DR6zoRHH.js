import{l as ee,j as e,K as te,a6 as re,X as se,r as x,Y as R,T as r,L as a,P as ae,M as m,U as g,N as W,O as H,a7 as O}from"./index-C6GUv-sR.js";import{u as V}from"./useQuery-Cvp8cW42.js";import{G as i,C as K}from"./Grid-0tarrWrJ.js";import{T as F,F as z,I as T,S as B}from"./TextField-Cq6ATHaf.js";import{I as $}from"./InputAdornment-Bjp0fACK.js";import{S as ie}from"./Search-CxIQ5aBM.js";import{S as b}from"./Skeleton-CbeuDcWj.js";import{C as Q}from"./CardContent-DJUwHkn2.js";import{C as oe}from"./CardMedia-CyWutE8y.js";import{L as ne}from"./LocationOn-68LIyIH1.js";import{V as le}from"./Visibility-B_2DgsVW.js";import{F as ce}from"./Favorite-DcEsGVo7.js";import{C as de}from"./CardActions-BAISUOln.js";import{P as xe,F as me}from"./Pagination-Baxxr6cC.js";import{A as he}from"./Add-Blzlj7xY.js";import"./LastPage-Cj5kg7ZO.js";const ue=ee(e.jsx("path",{d:"M3 18h6v-2H3zM3 6v2h18V6zm0 7h12v-2H3z"})),Fe=()=>{var E,G;const N=te(),[h,D]=re(),{isAuthenticated:U}=se(),[c,S]=x.useState(h.get("query")||""),[o,k]=x.useState(h.get("category")||""),[d,j]=x.useState(h.get("subcategory")||""),[n,C]=x.useState(h.get("minPrice")||""),[l,P]=x.useState(h.get("maxPrice")||""),[p,_]=x.useState(h.get("sortBy")||"newest"),[u,w]=x.useState(parseInt(h.get("page")||"1")),{data:I=[]}=V({queryKey:["categories"],queryFn:()=>O().getCategories()}),{data:s,isLoading:y,error:Y}=V({queryKey:["listings",{searchQuery:c,category:o,subcategory:d,minPrice:n,maxPrice:l,sortBy:p,page:u}],queryFn:()=>O().getListings({query:c||void 0,category:o||void 0,subcategory:d||void 0,minPrice:n?parseFloat(n):void 0,maxPrice:l?parseFloat(l):void 0},u,12)});x.useEffect(()=>{const t=new URLSearchParams;c&&t.set("query",c),o&&t.set("category",o),d&&t.set("subcategory",d),n&&t.set("minPrice",n),l&&t.set("maxPrice",l),p!=="newest"&&t.set("sortBy",p),u>1&&t.set("page",u.toString()),D(t)},[c,o,d,n,l,p,u,D]);const q=t=>{k(t),j(""),w(1)},A=I.find(t=>t.id===o),M=(A==null?void 0:A.subcategories)||[],J=t=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(t),X=t=>{const Z=new Date().getTime()-t.getTime(),v=Math.floor(Z/(1e3*60*60)),L=Math.floor(v/24);return L>0?`${L} day${L>1?"s":""} ago`:v>0?`${v} hour${v>1?"s":""} ago`:"Just now"};return Y?e.jsx(R,{maxWidth:"lg",sx:{mt:4},children:e.jsx(r,{color:"error",textAlign:"center",children:"Error loading listings. Please try again."})}):e.jsxs(R,{maxWidth:"lg",sx:{mt:2,mb:4},children:[e.jsxs(a,{sx:{mb:4},children:[e.jsx(r,{variant:"h4",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Browse Listings"}),e.jsx(r,{variant:"body1",color:"text.secondary",children:"Discover amazing deals from your local community"})]}),e.jsxs(ae,{elevation:2,sx:{p:3,mb:4,borderRadius:2},children:[e.jsxs(i,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(i,{item:!0,xs:12,md:4,children:e.jsx(F,{fullWidth:!0,placeholder:"Search listings...",value:c,onChange:t=>S(t.target.value),InputProps:{startAdornment:e.jsx($,{position:"start",children:e.jsx(ie,{})})}})}),e.jsx(i,{item:!0,xs:12,sm:6,md:2,children:e.jsxs(z,{fullWidth:!0,children:[e.jsx(T,{children:"Category"}),e.jsxs(B,{value:o,label:"Category",onChange:t=>q(t.target.value),children:[e.jsx(m,{value:"",children:"All Categories"}),I.map(t=>e.jsx(m,{value:t.id,children:t.name},t.id))]})]})}),M.length>0&&e.jsx(i,{item:!0,xs:12,sm:6,md:2,children:e.jsxs(z,{fullWidth:!0,children:[e.jsx(T,{children:"Subcategory"}),e.jsxs(B,{value:d,label:"Subcategory",onChange:t=>j(t.target.value),children:[e.jsx(m,{value:"",children:"All Subcategories"}),M.map(t=>e.jsx(m,{value:t.id,children:t.name},t.id))]})]})}),e.jsx(i,{item:!0,xs:6,md:1.5,children:e.jsx(F,{fullWidth:!0,label:"Min Price",type:"number",value:n,onChange:t=>C(t.target.value),InputProps:{startAdornment:e.jsx($,{position:"start",children:"₹"})}})}),e.jsx(i,{item:!0,xs:6,md:1.5,children:e.jsx(F,{fullWidth:!0,label:"Max Price",type:"number",value:l,onChange:t=>P(t.target.value),InputProps:{startAdornment:e.jsx($,{position:"start",children:"₹"})}})}),e.jsx(i,{item:!0,xs:12,sm:6,md:1,children:e.jsxs(z,{fullWidth:!0,children:[e.jsx(T,{children:"Sort"}),e.jsxs(B,{value:p,label:"Sort",onChange:t=>_(t.target.value),startAdornment:e.jsx(ue,{sx:{mr:1,color:"action.active"}}),children:[e.jsx(m,{value:"newest",children:"Newest"}),e.jsx(m,{value:"price-low",children:"Price: Low to High"}),e.jsx(m,{value:"price-high",children:"Price: High to Low"}),e.jsx(m,{value:"popular",children:"Most Popular"})]})]})})]}),e.jsxs(a,{sx:{mt:2,display:"flex",gap:1,flexWrap:"wrap"},children:[c&&e.jsx(g,{label:`Search: "${c}"`,onDelete:()=>S(""),color:"primary",variant:"outlined"}),o&&e.jsx(g,{label:`Category: ${(E=I.find(t=>t.id===o))==null?void 0:E.name}`,onDelete:()=>q(""),color:"primary",variant:"outlined"}),d&&e.jsx(g,{label:`Subcategory: ${(G=M.find(t=>t.id===d))==null?void 0:G.name}`,onDelete:()=>j(""),color:"primary",variant:"outlined"}),n&&e.jsx(g,{label:`Min: ₹${n}`,onDelete:()=>C(""),color:"primary",variant:"outlined"}),l&&e.jsx(g,{label:`Max: ₹${l}`,onDelete:()=>P(""),color:"primary",variant:"outlined"})]})]}),!y&&s&&e.jsxs(a,{sx:{mb:3,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(r,{variant:"body1",color:"text.secondary",children:[s.total," listings found"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Page ",u]})]}),e.jsx(i,{container:!0,spacing:3,children:y?Array.from({length:12}).map((t,f)=>e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(K,{children:[e.jsx(b,{variant:"rectangular",height:200}),e.jsxs(Q,{children:[e.jsx(b,{variant:"text",sx:{fontSize:"1.25rem"}}),e.jsx(b,{variant:"text"}),e.jsx(b,{variant:"text",width:"60%"})]})]})},f)):s==null?void 0:s.listings.map(t=>e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(K,{sx:{height:"100%",display:"flex",flexDirection:"column",cursor:"pointer",transition:"all 0.3s ease","&:hover":{transform:"translateY(-4px)",boxShadow:6}},onClick:()=>N(`${H.LISTINGS}/${t.id}`),children:[e.jsx(oe,{component:"img",height:"200",image:t.images[0]||"https://images.pexels.com/photos/593174/pexels-photo-593174.jpeg?auto=compress&cs=tinysrgb&w=400",alt:t.title}),e.jsxs(Q,{sx:{flexGrow:1},children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"start",mb:1},children:[e.jsx(r,{variant:"h6",component:"h3",noWrap:!0,sx:{flexGrow:1,mr:1},children:t.title}),e.jsx(g,{size:"small",label:t.category,color:"primary",variant:"outlined"})]}),e.jsx(r,{variant:"h5",color:"primary",gutterBottom:!0,sx:{fontWeight:"bold"},children:J(t.price)}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{display:"-webkit-box",overflow:"hidden",WebkitBoxOrient:"vertical",WebkitLineClamp:2,mb:2},children:t.description}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",color:"text.secondary",mb:1},children:[e.jsx(ne,{fontSize:"small",sx:{mr:.5}}),e.jsxs(r,{variant:"body2",noWrap:!0,children:[t.location.city,", ",t.location.state]})]}),e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:X(t.createdAt)}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",color:"text.secondary"},children:[e.jsx(le,{fontSize:"small",sx:{mr:.5}}),e.jsx(r,{variant:"body2",children:t.views})]}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",color:"text.secondary"},children:[e.jsx(ce,{fontSize:"small",sx:{mr:.5}}),e.jsx(r,{variant:"body2",children:t.favorites})]})]})]})]}),e.jsxs(de,{children:[e.jsx(W,{size:"small",color:"primary",children:"View Details"}),e.jsx(W,{size:"small",color:"secondary",children:"Contact Seller"})]})]})},t.id))}),!y&&(s==null?void 0:s.listings.length)===0&&e.jsxs(a,{textAlign:"center",sx:{py:8},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"No listings found"}),e.jsx(r,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"Try adjusting your search criteria or browse all categories"}),e.jsx(W,{variant:"contained",onClick:()=>{S(""),k(""),j(""),C(""),P(""),w(1)},children:"Clear All Filters"})]}),!y&&s&&Math.ceil(s.total/12)>1&&e.jsx(a,{sx:{display:"flex",justifyContent:"center",mt:6},children:e.jsx(xe,{count:Math.ceil(s.total/12),page:u,onChange:(t,f)=>w(f),color:"primary",size:"large"})}),U&&e.jsx(me,{color:"primary","aria-label":"create listing",sx:{position:"fixed",bottom:24,right:24},onClick:()=>N(H.CREATE_LISTING),children:e.jsx(he,{})})]})};export{Fe as default};
