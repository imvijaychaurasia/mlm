import{l as ee,j as e,I as te,a4 as re,V as se,r as d,T as r,J as a,P as ae,M as m,O as p,K as W,L as R,a5 as G}from"./index-CdLmDbyP.js";import{u as O}from"./useQuery-BsfG3bnB.js";import{C as V}from"./Container-DdslAScU.js";import{G as i,C as K}from"./Grid-DZ_ZG1Kc.js";import{T as L,F,I as B,S as T}from"./TextField-1taMTWt4.js";import{I as k}from"./InputAdornment-gEVnGQ-4.js";import{S as ie}from"./Search-C2CG_8zg.js";import{S as v}from"./Skeleton-BX3l6rpR.js";import{C as Q}from"./CardContent-CeDohtNq.js";import{C as oe}from"./CardMedia-BGNEwOU3.js";import{L as ne}from"./LocationOn-DrPu4HGy.js";import{V as le}from"./Visibility-Cmg8tzE9.js";import{F as ce}from"./Favorite-D9NYynTI.js";import{C as xe}from"./CardActions-Cjwyergk.js";import{P as de,F as me}from"./Pagination-Dj_Iooph.js";import{A as he}from"./Add-DZfvawOd.js";import"./LastPage-DJ2nohhr.js";const ue=ee(e.jsx("path",{d:"M3 18h6v-2H3zM3 6v2h18V6zm0 7h12v-2H3z"})),Fe=()=>{var E,H;const $=te(),[h,D]=re(),{isAuthenticated:_}=se(),[c,S]=d.useState(h.get("query")||""),[o,N]=d.useState(h.get("category")||""),[x,y]=d.useState(h.get("subcategory")||""),[n,C]=d.useState(h.get("minPrice")||""),[l,P]=d.useState(h.get("maxPrice")||""),[g,J]=d.useState(h.get("sortBy")||"newest"),[u,w]=d.useState(parseInt(h.get("page")||"1")),{data:I=[]}=O({queryKey:["categories"],queryFn:()=>G().getCategories()}),{data:s,isLoading:j,error:U}=O({queryKey:["listings",{searchQuery:c,category:o,subcategory:x,minPrice:n,maxPrice:l,sortBy:g,page:u}],queryFn:()=>G().getListings({query:c||void 0,category:o||void 0,subcategory:x||void 0,minPrice:n?parseFloat(n):void 0,maxPrice:l?parseFloat(l):void 0},u,12)});d.useEffect(()=>{const t=new URLSearchParams;c&&t.set("query",c),o&&t.set("category",o),x&&t.set("subcategory",x),n&&t.set("minPrice",n),l&&t.set("maxPrice",l),g!=="newest"&&t.set("sortBy",g),u>1&&t.set("page",u.toString()),D(t)},[c,o,x,n,l,g,u,D]);const q=t=>{N(t),y(""),w(1)},z=I.find(t=>t.id===o),A=(z==null?void 0:z.subcategories)||[],Y=t=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(t),X=t=>{const Z=new Date().getTime()-t.getTime(),b=Math.floor(Z/(1e3*60*60)),M=Math.floor(b/24);return M>0?`${M} day${M>1?"s":""} ago`:b>0?`${b} hour${b>1?"s":""} ago`:"Just now"};return U?e.jsx(V,{maxWidth:"lg",sx:{px:{xs:2,sm:3},py:{xs:2,sm:3}},children:e.jsx(r,{color:"error",textAlign:"center",children:"Error loading listings. Please try again."})}):e.jsxs(V,{maxWidth:"lg",sx:{px:{xs:2,sm:3},py:{xs:2,sm:3}},children:[e.jsxs(a,{sx:{mb:4},children:[e.jsx(r,{variant:"h4",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Browse Listings"}),e.jsx(r,{variant:"body1",color:"text.secondary",children:"Discover amazing deals from your local community"})]}),e.jsxs(ae,{elevation:2,sx:{p:3,mb:4,borderRadius:2},children:[e.jsxs(i,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(i,{item:!0,xs:12,sm:6,md:4,children:e.jsx(L,{fullWidth:!0,placeholder:"Search listings...",value:c,onChange:t=>S(t.target.value),InputProps:{startAdornment:e.jsx(k,{position:"start",children:e.jsx(ie,{})})}})}),e.jsx(i,{item:!0,xs:6,sm:3,md:2,children:e.jsxs(F,{fullWidth:!0,children:[e.jsx(B,{children:"Category"}),e.jsxs(T,{value:o,label:"Category",onChange:t=>q(t.target.value),children:[e.jsx(m,{value:"",children:"All Categories"}),I.map(t=>e.jsx(m,{value:t.id,children:t.name},t.id))]})]})}),A.length>0&&e.jsx(i,{item:!0,xs:6,sm:3,md:2,children:e.jsxs(F,{fullWidth:!0,children:[e.jsx(B,{children:"Subcategory"}),e.jsxs(T,{value:x,label:"Subcategory",onChange:t=>y(t.target.value),children:[e.jsx(m,{value:"",children:"All Subcategories"}),A.map(t=>e.jsx(m,{value:t.id,children:t.name},t.id))]})]})}),e.jsx(i,{item:!0,xs:6,sm:3,md:1.5,children:e.jsx(L,{fullWidth:!0,label:"Min Price",type:"number",value:n,onChange:t=>C(t.target.value),InputProps:{startAdornment:e.jsx(k,{position:"start",children:"₹"})}})}),e.jsx(i,{item:!0,xs:6,sm:3,md:1.5,children:e.jsx(L,{fullWidth:!0,label:"Max Price",type:"number",value:l,onChange:t=>P(t.target.value),InputProps:{startAdornment:e.jsx(k,{position:"start",children:"₹"})}})}),e.jsx(i,{item:!0,xs:12,sm:6,md:2,children:e.jsxs(F,{fullWidth:!0,children:[e.jsx(B,{children:"Sort"}),e.jsxs(T,{value:g,label:"Sort",onChange:t=>J(t.target.value),startAdornment:e.jsx(ue,{sx:{mr:1,color:"action.active"}}),children:[e.jsx(m,{value:"newest",children:"Newest"}),e.jsx(m,{value:"price-low",children:"Price: Low to High"}),e.jsx(m,{value:"price-high",children:"Price: High to Low"}),e.jsx(m,{value:"popular",children:"Most Popular"})]})]})})]}),e.jsxs(a,{sx:{mt:2,display:"flex",gap:1,flexWrap:"wrap"},children:[c&&e.jsx(p,{label:`Search: "${c}"`,onDelete:()=>S(""),color:"primary",variant:"outlined"}),o&&e.jsx(p,{label:`Category: ${(E=I.find(t=>t.id===o))==null?void 0:E.name}`,onDelete:()=>q(""),color:"primary",variant:"outlined"}),x&&e.jsx(p,{label:`Subcategory: ${(H=A.find(t=>t.id===x))==null?void 0:H.name}`,onDelete:()=>y(""),color:"primary",variant:"outlined"}),n&&e.jsx(p,{label:`Min: ₹${n}`,onDelete:()=>C(""),color:"primary",variant:"outlined"}),l&&e.jsx(p,{label:`Max: ₹${l}`,onDelete:()=>P(""),color:"primary",variant:"outlined"})]})]}),!j&&s&&e.jsxs(a,{sx:{mb:3,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(r,{variant:"body1",color:"text.secondary",children:[s.total," listings found"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Page ",u]})]}),e.jsx(i,{container:!0,spacing:3,children:j?Array.from({length:20}).map((t,f)=>e.jsx(i,{item:!0,xs:12,sm:6,md:3,lg:2.4,children:e.jsxs(K,{children:[e.jsx(v,{variant:"rectangular",height:160}),e.jsxs(Q,{children:[e.jsx(v,{variant:"text",sx:{fontSize:"1.25rem"}}),e.jsx(v,{variant:"text"}),e.jsx(v,{variant:"text",width:"60%"})]})]})},f)):s==null?void 0:s.listings.map(t=>e.jsx(i,{item:!0,xs:12,sm:6,md:3,lg:2.4,children:e.jsxs(K,{sx:{height:"100%",display:"flex",flexDirection:"column",cursor:"pointer",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)","&:hover":{transform:"translateY(-6px)",boxShadow:"0px 20px 25px -5px rgba(0, 0, 0, 0.1), 0px 10px 10px -5px rgba(0, 0, 0, 0.04)"}},onClick:()=>$(`${R.LISTINGS}/${t.id}`),children:[e.jsx(oe,{component:"img",height:"160",image:t.images[0]||"https://images.pexels.com/photos/593174/pexels-photo-593174.jpeg?auto=compress&cs=tinysrgb&w=400",alt:t.title,sx:{objectFit:"cover",aspectRatio:"16/10"}}),e.jsxs(Q,{sx:{flexGrow:1,p:1.5},children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"start",mb:1},children:[e.jsx(r,{variant:"h6",component:"h3",sx:{flexGrow:1,mr:1,fontSize:"0.95rem",fontWeight:600,lineHeight:1.3,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:t.title}),e.jsx(p,{size:"small",label:t.category,color:"primary",variant:"outlined",sx:{flexShrink:0}})]}),e.jsx(r,{variant:"h5",color:"primary",gutterBottom:!0,sx:{fontWeight:"bold",fontSize:"1.1rem",mb:1},children:Y(t.price)}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{display:"-webkit-box",overflow:"hidden",WebkitBoxOrient:"vertical",WebkitLineClamp:1,mb:2,fontSize:"0.8rem",lineHeight:1.4},children:t.description}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",color:"text.secondary",mb:1},children:[e.jsx(ne,{fontSize:"small",sx:{mr:.5}}),e.jsxs(r,{variant:"body2",noWrap:!0,sx:{fontSize:"0.8rem"},children:[t.location.city,", ",t.location.state]})]}),e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(r,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.7rem"},children:X(t.createdAt)}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",color:"text.secondary"},children:[e.jsx(le,{fontSize:"small",sx:{mr:.5}}),e.jsx(r,{variant:"body2",sx:{fontSize:"0.7rem"},children:t.views})]}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",color:"text.secondary"},children:[e.jsx(ce,{fontSize:"small",sx:{mr:.5}}),e.jsx(r,{variant:"body2",sx:{fontSize:"0.7rem"},children:t.favorites})]})]})]})]}),e.jsxs(xe,{sx:{p:1.5,pt:0},children:[e.jsx(W,{size:"small",color:"primary",sx:{fontSize:"0.75rem"},children:"View Details"}),e.jsx(W,{size:"small",color:"secondary",sx:{fontSize:"0.75rem"},children:"Contact Seller"})]})]})},t.id))}),!j&&(s==null?void 0:s.listings.length)===0&&e.jsxs(a,{textAlign:"center",sx:{py:8},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"No listings found"}),e.jsx(r,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"Try adjusting your search criteria or browse all categories"}),e.jsx(W,{variant:"contained",onClick:()=>{S(""),N(""),y(""),C(""),P(""),w(1)},children:"Clear All Filters"})]}),!j&&s&&Math.ceil(s.total/12)>1&&e.jsx(a,{sx:{display:"flex",justifyContent:"center",mt:6},children:e.jsx(de,{count:Math.ceil(s.total/12),page:u,onChange:(t,f)=>w(f),color:"primary",size:"large"})}),_&&e.jsx(me,{color:"primary","aria-label":"create listing",sx:{position:"fixed",bottom:24,right:24},onClick:()=>$(R.CREATE_LISTING),children:e.jsx(he,{})})]})};export{Fe as default};
