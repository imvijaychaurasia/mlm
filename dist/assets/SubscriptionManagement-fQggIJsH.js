import{l as F,j as e,r as d,J as v,T as r,K as h,O as $,P as te,X as se}from"./index-CdLmDbyP.js";import{u as ie,C as p,o as ne,c as re,d as g}from"./index.esm--sOyZdxh.js";import{g as ae,a as q,f as j,u as oe}from"./pricing-CnH_CcUh.js";import{C as ce}from"./ConfirmDialog-BsscMqaM.js";import{P as W}from"./Payment-DYV_0DeT.js";import{C as le}from"./Container-DdslAScU.js";import{E as de}from"./Edit-ClGKuL4k.js";import{G as l,C as me}from"./Grid-DZ_ZG1Kc.js";import{C as xe}from"./CardContent-CeDohtNq.js";import{T as B,a as k,b as E,c as P,d as n,e as z}from"./TableRow-DzBs-c_a.js";import{D as M,a as O,b as N,c as R,S as ue}from"./Snackbar-DUmikhNv.js";import{T as f}from"./TextField-1taMTWt4.js";import{I as L}from"./InputAdornment-gEVnGQ-4.js";import{C as I}from"./CurrencyRupee-ClDlr6Nd.js";import"./Warning-k1XW5kCD.js";const he=F(e.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"})),U=F(e.jsx("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8z"})),pe=F(e.jsx("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"})),ge=re().shape({contactPassPrice:g().positive("Contact pass price must be positive").max(1e4,"Price cannot exceed ₹10,000").required("Contact pass price is required"),contactPassDuration:g().positive("Duration must be positive").max(365,"Duration cannot exceed 365 days").required("Duration is required"),listingPrice:g().positive("Listing price must be positive").max(1e4,"Price cannot exceed ₹10,000").required("Listing price is required"),listingDuration:g().positive("Duration must be positive").max(365,"Duration cannot exceed 365 days").required("Duration is required"),viewContactsAddonPrice:g().positive("Addon price must be positive").max(1e4,"Price cannot exceed ₹10,000").required("Addon price is required")}),Fe=()=>{const[a,G]=d.useState(ae()),[K,b]=d.useState(!1),[J,D]=d.useState(!1),[m,S]=d.useState({open:!1,title:"",message:"",onConfirm:()=>{}}),[T,w]=d.useState({open:!1,message:"",severity:"info"}),[y,X]=d.useState(q()),{control:x,handleSubmit:Q,reset:A,formState:{errors:o,isDirty:Y}}=ie({resolver:ne(ge),defaultValues:a});d.useEffect(()=>{A(a)},[a,A]);const Z=()=>{b(!0)},_=t=>{const s=Object.keys(t).reduce((c,u)=>{const C=u;return t[C]!==a[C]&&(c[C]=t[C]),c},{});if(Object.keys(s).length===0){w({open:!0,message:"No changes detected",severity:"info"}),b(!1);return}const i=Object.entries(s).map(([c,u])=>`${c}: ${j(u)}`).join(", ");S({open:!0,title:"Confirm Price Changes",message:`Are you sure you want to update the following prices?

${i}

These changes will be reflected immediately across the platform.`,onConfirm:()=>{const c=oe(s);G(c),X(q()),b(!1),S({...m,open:!1}),w({open:!0,message:"Subscription pricing updated successfully",severity:"success"})}})},H=()=>{A(a),b(!1)},V=t=>new Intl.DateTimeFormat("en-IN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(t)),ee=[{title:"Contact Pass",description:"Unlimited seller contact access",price:a.contactPassPrice,duration:a.contactPassDuration,durationLabel:"days",icon:e.jsx(W,{color:"primary"})},{title:"Listing Fee",description:"Post and promote listings",price:a.listingPrice,duration:a.listingDuration,durationLabel:"days",icon:e.jsx(W,{color:"secondary"})},{title:"View Contacts Addon",description:"See interested buyer contacts",price:a.viewContactsAddonPrice,duration:null,durationLabel:"one-time",icon:e.jsx(W,{color:"success"})}];return e.jsxs(le,{maxWidth:"lg",sx:{px:{xs:2,sm:3},py:{xs:2,sm:3}},children:[e.jsxs(v,{sx:{mb:4,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx(r,{variant:"h4",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Subscription Management"}),e.jsx(r,{variant:"body1",color:"text.secondary",children:"Manage pricing for platform subscriptions and services"})]}),e.jsxs(v,{sx:{display:"flex",gap:2},children:[e.jsx(h,{variant:"outlined",startIcon:e.jsx(U,{}),onClick:()=>D(!0),children:"View History"}),e.jsx(h,{variant:"contained",startIcon:e.jsx(de,{}),onClick:Z,children:"Edit Pricing"})]})]}),e.jsx(l,{container:!0,spacing:3,sx:{mb:4},children:ee.map((t,s)=>e.jsx(l,{item:!0,xs:12,sm:6,md:4,children:e.jsx(me,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:e.jsxs(xe,{sx:{flexGrow:1},children:[e.jsxs(v,{sx:{display:"flex",alignItems:"center",mb:2},children:[t.icon,e.jsx(r,{variant:"h6",sx:{ml:1,fontWeight:"bold"},children:t.title})]}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:2},children:t.description}),e.jsx(r,{variant:"h4",color:"primary",sx:{fontWeight:"bold",mb:1},children:j(t.price)}),e.jsx($,{size:"small",label:t.duration?`${t.duration} ${t.durationLabel}`:t.durationLabel,color:"primary",variant:"outlined"})]})})},s))}),y.length>0&&e.jsxs(te,{elevation:2,sx:{p:3,borderRadius:2},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Recent Changes"}),e.jsx(B,{children:e.jsxs(k,{size:"small",children:[e.jsx(E,{children:e.jsxs(P,{children:[e.jsx(n,{children:"Date & Time"}),e.jsx(n,{children:"Changes Made"}),e.jsx(n,{children:"Updated By"})]})}),e.jsx(z,{children:y.slice(-5).reverse().map((t,s)=>e.jsxs(P,{children:[e.jsx(n,{children:V(t.timestamp)}),e.jsx(n,{children:Object.entries(t.changes).map(([i,c])=>e.jsx($,{size:"small",label:`${i}: ${j(c)}`,color:"info",variant:"outlined",sx:{mr:1,mb:.5}},i))}),e.jsx(n,{children:t.updatedBy})]},s))})]})})]}),e.jsxs(M,{open:K,onClose:H,maxWidth:"md",fullWidth:!0,children:[e.jsx(O,{children:"Edit Subscription Pricing"}),e.jsxs("form",{onSubmit:Q(_),children:[e.jsxs(N,{children:[e.jsxs(se,{severity:"info",sx:{mb:3},children:[e.jsx(r,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:"Important Notice"}),e.jsx(r,{variant:"body2",children:"Price changes will be reflected immediately across the platform. All new transactions will use the updated pricing."})]}),e.jsxs(l,{container:!0,spacing:3,children:[e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(p,{name:"contactPassPrice",control:x,render:({field:t})=>{var s;return e.jsx(f,{...t,fullWidth:!0,label:"Contact Pass Price",type:"number",error:!!o.contactPassPrice,helperText:((s=o.contactPassPrice)==null?void 0:s.message)||"Price for 15-day contact access",InputProps:{startAdornment:e.jsx(L,{position:"start",children:e.jsx(I,{})})},onChange:i=>t.onChange(parseFloat(i.target.value)||0)})}})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(p,{name:"contactPassDuration",control:x,render:({field:t})=>{var s;return e.jsx(f,{...t,fullWidth:!0,label:"Contact Pass Duration (Days)",type:"number",error:!!o.contactPassDuration,helperText:((s=o.contactPassDuration)==null?void 0:s.message)||"Validity period in days",onChange:i=>t.onChange(parseFloat(i.target.value)||0)})}})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(p,{name:"listingPrice",control:x,render:({field:t})=>{var s;return e.jsx(f,{...t,fullWidth:!0,label:"Listing Fee",type:"number",error:!!o.listingPrice,helperText:((s=o.listingPrice)==null?void 0:s.message)||"One-time fee to post a listing",InputProps:{startAdornment:e.jsx(L,{position:"start",children:e.jsx(I,{})})},onChange:i=>t.onChange(parseFloat(i.target.value)||0)})}})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(p,{name:"listingDuration",control:x,render:({field:t})=>{var s;return e.jsx(f,{...t,fullWidth:!0,label:"Listing Duration (Days)",type:"number",error:!!o.listingDuration,helperText:((s=o.listingDuration)==null?void 0:s.message)||"How long listing stays active",onChange:i=>t.onChange(parseFloat(i.target.value)||0)})}})}),e.jsx(l,{item:!0,xs:12,sm:6,children:e.jsx(p,{name:"viewContactsAddonPrice",control:x,render:({field:t})=>{var s;return e.jsx(f,{...t,fullWidth:!0,label:"View Contacts Addon Price",type:"number",error:!!o.viewContactsAddonPrice,helperText:((s=o.viewContactsAddonPrice)==null?void 0:s.message)||"Price to see interested buyer contacts",InputProps:{startAdornment:e.jsx(L,{position:"start",children:e.jsx(I,{})})},onChange:i=>t.onChange(parseFloat(i.target.value)||0)})}})})]})]}),e.jsxs(R,{children:[e.jsx(h,{onClick:H,startIcon:e.jsx(he,{}),children:"Cancel"}),e.jsx(h,{type:"submit",variant:"contained",startIcon:e.jsx(pe,{}),disabled:!Y,children:"Save Changes"})]})]})]}),e.jsxs(M,{open:J,onClose:()=>D(!1),maxWidth:"lg",fullWidth:!0,children:[e.jsx(O,{children:"Pricing Change History"}),e.jsx(N,{children:y.length===0?e.jsxs(v,{sx:{textAlign:"center",py:4},children:[e.jsx(U,{sx:{fontSize:"3rem",color:"text.secondary",mb:2}}),e.jsx(r,{variant:"h6",gutterBottom:!0,children:"No pricing changes yet"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"All pricing changes will be logged here for audit purposes"})]}):e.jsx(B,{children:e.jsxs(k,{children:[e.jsx(E,{children:e.jsxs(P,{children:[e.jsx(n,{children:"Date & Time"}),e.jsx(n,{children:"Field Changed"}),e.jsx(n,{children:"Previous Value"}),e.jsx(n,{children:"New Value"}),e.jsx(n,{children:"Updated By"})]})}),e.jsx(z,{children:y.reverse().map((t,s)=>Object.entries(t.changes).map(([i,c],u)=>e.jsxs(P,{children:[e.jsx(n,{children:V(t.timestamp)}),e.jsx(n,{children:e.jsx(r,{variant:"body2",sx:{fontWeight:"medium"},children:i})}),e.jsx(n,{children:j(t.previousValues[i])}),e.jsx(n,{children:e.jsx(r,{variant:"body2",sx:{fontWeight:"bold",color:"primary.main"},children:j(c)})}),e.jsx(n,{children:t.updatedBy})]},`${s}-${u}`)))})]})})}),e.jsx(R,{children:e.jsx(h,{onClick:()=>D(!1),children:"Close"})})]}),e.jsx(ce,{open:m.open,title:m.title,message:m.message,onConfirm:m.onConfirm,onCancel:()=>S({...m,open:!1}),confirmText:"Update Pricing",destructive:!1}),e.jsx(ue,{open:T.open,autoHideDuration:4e3,onClose:()=>w({...T,open:!1}),message:T.message})]})};export{Fe as default};
