import{I as z,U as F,V as I,r as n,L as h,$ as S,j as e,P as N,J as d,T as o,W as O,K as x,Y as A}from"./index-PhArAd-9.js";import{u as U,C as B,o as D,c as M,a as $}from"./index.esm-BvHZ2h58.js";import{C as q}from"./Container-Op_3z2Kr.js";import{T as H}from"./TextField-NKzEA2r4.js";const G=M().shape({otp:$().length(6,"OTP must be 6 digits").required("OTP is required")}),X=()=>{var T;const i=z(),C=F(),{user:u,setUser:E,setToken:R}=I(),[p,l]=n.useState(null),[g,W]=n.useState(null),[f,y]=n.useState(!1),[m,b]=n.useState(!1),[a,j]=n.useState(0),s=((T=C.state)==null?void 0:T.phone)||(u==null?void 0:u.phone),{control:k,handleSubmit:w,formState:{errors:v}}=U({resolver:D(G),defaultValues:{otp:""}});n.useEffect(()=>{if(!s){i(h.LOGIN);return}P()},[s,i]),n.useEffect(()=>{if(a>0){const t=setTimeout(()=>j(a-1),1e3);return()=>clearTimeout(t)}},[a]);const P=async()=>{if(s){b(!0),l(null);try{const r=await S().sendOTP(s);W(r.message),j(30)}catch(t){l(t.message||"Failed to send OTP. Please try again.")}finally{b(!1)}}},L=async t=>{if(s){y(!0),l(null);try{const c=await S().verifyOTP({phone:s,otp:t.otp});E(c.user),R(c.token),i(h.HOME)}catch(r){l(r.message||"Invalid OTP. Please try again.")}finally{y(!1)}}};return s?e.jsx(q,{maxWidth:"sm",sx:{mt:4,mb:4},children:e.jsxs(N,{elevation:3,sx:{p:4,borderRadius:3},children:[e.jsxs(d,{textAlign:"center",mb:4,children:[e.jsx(o,{variant:"h4",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold"},children:"Verify Phone Number"}),e.jsx(o,{variant:"body1",color:"text.secondary",children:"We've sent a 6-digit code to"}),e.jsx(o,{variant:"h6",color:"primary",sx:{mt:1},children:s})]}),e.jsx("div",{id:"recaptcha-container",style:{display:"none"}}),p&&e.jsx(O,{severity:"error",sx:{mb:3},children:p}),g&&e.jsx(O,{severity:"success",sx:{mb:3},children:g}),e.jsxs("form",{onSubmit:w(L),children:[e.jsx(B,{name:"otp",control:k,render:({field:t})=>{var r;return e.jsx(H,{...t,fullWidth:!0,label:"Enter 6-digit OTP",margin:"normal",error:!!v.otp,helperText:(r=v.otp)==null?void 0:r.message,autoComplete:"one-time-code",autoFocus:!0,inputProps:{maxLength:6,style:{textAlign:"center",fontSize:"1.5rem",letterSpacing:"0.5rem"}},onChange:c=>{const V=c.target.value.replace(/\D/g,"");t.onChange(V)}})}}),e.jsx(x,{type:"submit",fullWidth:!0,variant:"contained",size:"large",disabled:f,sx:{mt:3,mb:2,py:1.5},children:f?e.jsx(A,{size:24}):"Verify Phone Number"})]}),e.jsxs(d,{textAlign:"center",mt:3,children:[e.jsx(o,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Didn't receive the code?"}),a>0?e.jsxs(o,{variant:"body2",color:"text.secondary",children:["Resend OTP in ",a," seconds"]}):e.jsx(x,{variant:"text",onClick:P,disabled:m,startIcon:m?e.jsx(A,{size:16}):null,children:m?"Sending...":"Resend OTP"})]}),e.jsxs(d,{sx:{mt:3,p:2,bgcolor:"info.light",borderRadius:1,border:"1px solid",borderColor:"info.main"},children:[e.jsx(o,{variant:"body2",sx:{fontWeight:"bold",mb:1},children:"Demo Mode:"}),e.jsxs(o,{variant:"body2",children:["Use OTP: ",e.jsx("strong",{children:"123456"})," to verify any phone number"]})]}),e.jsx(d,{textAlign:"center",mt:3,children:e.jsx(x,{variant:"text",onClick:()=>i(h.HOME),children:"Skip for now"})})]})}):null};export{X as default};
